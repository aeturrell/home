---
title: "A Treasure Map"
layout: "post"
permalink: "/2015/09/a-treasure-map.html"
uuid: "6253596403712280138"
guid: "tag:blogger.com,1999:blog-6688000445931755418.post-6253596403712280138"
date: "2015-09-28 18:02:00"
updated: "2017-03-13 21:40:50"
description: 
blogger:
    siteid: "6688000445931755418"
    postid: "6253596403712280138"
    comments: "0"
categories: [scatter, python, coding]
author: 
    name: "Arthur"
    url: "undefined?rel=author"
    image: "//1.bp.blogspot.com/_drwYU0dxe18/TJE68EIlU2I/AAAAAAAAAAg/NgbbDCnHJRI/S220-s32/pic+of+me.jpg"
---

<div class="css-full-post-content js-full-post-content">
<b>Treasure hunts are good fun.</b><span style="font-weight: normal;">&nbsp;Amazingly, people do occasionally find buried treasure. I expect it's usually by mistake, but in fiction there's always a treasure map.</span><br /><span style="font-weight: normal;"><br /></span><span style="font-weight: normal;">While a treasure map of treasure that's already been found is of little practical use (though I'm sure you could do something with Bayesian inference and some old maps), it's a nice way to demonstrate some of the functionality of Python, on web-scraping and geo-plotting.&nbsp;</span><br /><span style="font-weight: normal;"><br /></span><span style="font-weight: normal;">For the data, there's a <a href="https://en.wikipedia.org/wiki/List_of_hoards_in_Great_Britain">wikipedia page</a> of all the treasure hoards found in the UK. This includes the latitude and longitude of every declared UK hoard.</span><br /><span style="font-weight: normal;"><br /></span><span style="font-weight: normal;">This is all embarrassingly easy thanks to Python. Python can do anything (it seems)&nbsp;<i>if</i>&nbsp;you can get the modules to install and compile.</span><br /><span style="font-weight: normal;"><br /></span><span style="font-weight: normal;">The code to grab the data from the wikipedia page is:</span><!-- HTML generated using hilite.me --><br /><span style="font-weight: normal;"><br /></span><br /><div style="background: #ffffff; border-width: .1em .1em .1em .8em; border: solid gray; overflow: auto; padding: .2em .6em; width: auto;"><pre style="line-height: 125%; margin: 0;"><span style="color: #008800; font-weight: bold;">from</span> <span style="color: #0e84b5; font-weight: bold;">lxml</span> <span style="color: #008800; font-weight: bold;">import</span> html<br /><span style="color: #008800; font-weight: bold;">from</span> <span style="color: #0e84b5; font-weight: bold;">numpy</span> <span style="color: #008800; font-weight: bold;">import</span> array<br /><br /><span style="color: #008800; font-weight: bold;">import</span> <span style="color: #0e84b5; font-weight: bold;">requests</span><br />page <span style="color: #333333;">=</span> requests<span style="color: #333333;">.</span>get(<span style="background-color: #fff0f0;">'https://en.wikipedia.org/wiki/List_of_hoards_in_Great_Britain'</span>)<br />tree <span style="color: #333333;">=</span> html<span style="color: #333333;">.</span>fromstring(page<span style="color: #333333;">.</span>text)<br />loc <span style="color: #333333;">=</span> tree<span style="color: #333333;">.</span>xpath(<span style="background-color: #fff0f0;">'//span[@class="geo"]/text()'</span>)<br />name_loc <span style="color: #333333;">=</span> tree<span style="color: #333333;">.</span>xpath(<span style="background-color: #fff0f0;">'//span[@class="fn org"]/text()'</span>)<br /></pre><pre style="line-height: 125%; margin: 0;"></pre><pre style="line-height: 125%; margin: 0;"></pre></div><br />It's that simple. 'loc' stores the latitude and longitude of all the hoards found, but it's not in a great format. To clean it up, I used:  <!-- HTML generated using hilite.me --><br /><div style="background: #ffffff; border-width: .1em .1em .1em .8em; border: solid gray; overflow: auto; padding: .2em .6em; width: auto;"><pre style="line-height: 125%; margin: 0;">locarray <span style="color: #333333;">=</span> array([i<span style="color: #333333;">.</span>split(<span style="background-color: #fff0f0;">";"</span>) <span style="color: #008800; font-weight: bold;">for</span> i <span style="color: black; font-weight: bold;">in</span> loc])<br />floatlat <span style="color: #333333;">=</span> [<span style="color: #007020;">float</span>(i[<span style="color: #0000dd; font-weight: bold;">0</span>]) <span style="color: #008800; font-weight: bold;">for</span> i <span style="color: black; font-weight: bold;">in</span> locarray]<br />floatlong <span style="color: #333333;">=</span> [<span style="color: #007020;">float</span>(i[<span style="color: #0000dd; font-weight: bold;">1</span>]) <span style="color: #008800; font-weight: bold;">for</span> i <span style="color: black; font-weight: bold;">in</span> locarray]<br /></pre></div><br />after import array from numpy. All that remains is to plot the data using Basemap, and (with a bit of tweaking) centre on the relevant part of the planet, the UK. The final result is shown below<br /><div class="separator" style="clear: both; text-align: center;"></div><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-hOQRr70CA8k/Vgl_5DJkhBI/AAAAAAAAAe4/pQuJeL2UMJU/s1600/buriedtreasure.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="640" src="https://4.bp.blogspot.com/-hOQRr70CA8k/Vgl_5DJkhBI/AAAAAAAAAe4/pQuJeL2UMJU/s640/buriedtreasure.png" width="422" /></a></div><div class="separator" style="clear: both; text-align: center;"><br /></div><br />It's quite incredible that this takes less than 60 lines of code. The full code is included below.<br /><br /><!-- HTML generated using hilite.me --><br /><div style="background: #ffffff; border-width: .1em .1em .1em .8em; border: solid gray; overflow: auto; padding: .2em .6em; width: auto;"><pre style="line-height: 125%; margin: 0;"><span style="color: #888888;"># -*- coding: utf-8 -*-</span><br /><span style="color: #dd4422;">"""</span><br /><br /><br /><span style="color: #dd4422;">@author: Markov Wanderer</span><br /><span style="color: #dd4422;">"""</span><br /><br /><br /><br /><span style="color: #008800; font-weight: bold;">from</span> <span style="color: #0e84b5; font-weight: bold;">mpl_toolkits.basemap</span> <span style="color: #008800; font-weight: bold;">import</span> Basemap<br /><span style="color: #008800; font-weight: bold;">import</span> <span style="color: #0e84b5; font-weight: bold;">matplotlib.pyplot</span> <span style="color: #008800; font-weight: bold;">as</span> <span style="color: #0e84b5; font-weight: bold;">plt</span><br /><span style="color: #008800; font-weight: bold;">from</span> <span style="color: #0e84b5; font-weight: bold;">lxml</span> <span style="color: #008800; font-weight: bold;">import</span> html<br /><span style="color: #008800; font-weight: bold;">import</span> <span style="color: #0e84b5; font-weight: bold;">requests</span><br /><span style="color: #008800; font-weight: bold;">from</span> <span style="color: #0e84b5; font-weight: bold;">numpy</span> <span style="color: #008800; font-weight: bold;">import</span> array<br /><br /><span style="color: #888888;">#</span><br /><span style="color: #888888;">#  Grab the data from the web</span><br /><span style="color: #888888;">#</span><br /><span style="color: #888888;">#</span><br />page <span style="color: #333333;">=</span> requests<span style="color: #333333;">.</span>get(<span style="background-color: #fff0f0;">'https://en.wikipedia.org/wiki/List_of_hoards_in_Great_Britain'</span>)<br />tree <span style="color: #333333;">=</span> html<span style="color: #333333;">.</span>fromstring(page<span style="color: #333333;">.</span>text)<br /><span style="color: #888888;"># Store the locations of the hoards</span><br />loc <span style="color: #333333;">=</span> tree<span style="color: #333333;">.</span>xpath(<span style="background-color: #fff0f0;">'//span[@class="geo"]/text()'</span>)<br /><span style="color: #888888;">#This will create a list of names of hoards (unused):</span><br />name_loc <span style="color: #333333;">=</span> tree<span style="color: #333333;">.</span>xpath(<span style="background-color: #fff0f0;">'//span[@class="fn org"]/text()'</span>)<br />locarray <span style="color: #333333;">=</span> array([i<span style="color: #333333;">.</span>split(<span style="background-color: #fff0f0;">";"</span>) <span style="color: #008800; font-weight: bold;">for</span> i <span style="color: black; font-weight: bold;">in</span> loc])<br />floatlat <span style="color: #333333;">=</span> [<span style="color: #007020;">float</span>(i[<span style="color: #0000dd; font-weight: bold;">0</span>]) <span style="color: #008800; font-weight: bold;">for</span> i <span style="color: black; font-weight: bold;">in</span> locarray]<br />floatlong <span style="color: #333333;">=</span> [<span style="color: #007020;">float</span>(i[<span style="color: #0000dd; font-weight: bold;">1</span>]) <span style="color: #008800; font-weight: bold;">for</span> i <span style="color: black; font-weight: bold;">in</span> locarray]<br /><br /><span style="color: #888888;">#</span><br /><span style="color: #888888;">#  Use Basemap to do the plotting</span><br /><span style="color: #888888;">#</span><br /><span style="color: #888888;">#</span><br /><span style="color: #007020;">map</span> <span style="color: #333333;">=</span> Basemap(projection<span style="color: #333333;">=</span><span style="background-color: #fff0f0;">'merc'</span>, lat_0<span style="color: #333333;">=</span><span style="color: #0000dd; font-weight: bold;">51</span>,lon_0<span style="color: #333333;">=</span><span style="color: #6600ee; font-weight: bold;">0.12</span>,<br />    resolution <span style="color: #333333;">=</span> <span style="background-color: #fff0f0;">'h'</span>, area_thresh <span style="color: #333333;">=</span> <span style="color: #6600ee; font-weight: bold;">0.1</span>,<br />    llcrnrlon<span style="color: #333333;">=-</span><span style="color: #0000dd; font-weight: bold;">8</span>, llcrnrlat<span style="color: #333333;">=</span><span style="color: #6600ee; font-weight: bold;">49.5</span>,<br />    urcrnrlon<span style="color: #333333;">=</span><span style="color: #0000dd; font-weight: bold;">3</span>, urcrnrlat<span style="color: #333333;">=</span><span style="color: #6600ee; font-weight: bold;">59.5</span>)<br /><span style="color: #888888;"># draw coastlines, country boundaries, fill continents.</span><br /><span style="color: #007020;">map</span><span style="color: #333333;">.</span>drawcoastlines(linewidth<span style="color: #333333;">=</span><span style="color: #6600ee; font-weight: bold;">0.25</span>)<br /><span style="color: #007020;">map</span><span style="color: #333333;">.</span>drawcountries(linewidth<span style="color: #333333;">=</span><span style="color: #6600ee; font-weight: bold;">0.25</span>)<br /><span style="color: #007020;">map</span><span style="color: #333333;">.</span>fillcontinents(color<span style="color: #333333;">=</span><span style="background-color: #fff0f0;">'coral'</span>,lake_color<span style="color: #333333;">=</span><span style="background-color: #fff0f0;">'aqua'</span>)<br /><span style="color: #888888;"># draw the edge of the map projection region (the projection limb)</span><br /><span style="color: #007020;">map</span><span style="color: #333333;">.</span>drawmapboundary(fill_color<span style="color: #333333;">=</span><span style="background-color: #fff0f0;">'aqua'</span>)<br /><span style="color: #888888;"># Make lat and long points of hoards</span><br />x,y <span style="color: #333333;">=</span> <span style="color: #007020;">map</span>(floatlong, floatlat)<br /><span style="color: #888888;"># Plot the hoards</span><br /><span style="color: #007020;">map</span><span style="color: #333333;">.</span>plot(x, y, <span style="background-color: #fff0f0;">'bo'</span>, markersize<span style="color: #333333;">=</span><span style="color: #0000dd; font-weight: bold;">5</span>)<br />plt<span style="color: #333333;">.</span>title(<span style="background-color: #fff0f0;">'Locations of buried treasure in the UK'</span>)<br />plt<span style="color: #333333;">.</span>show()<br /></pre></div>
</div>